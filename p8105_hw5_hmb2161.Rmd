---
title: "hw5"
output: github_document
---

```{r setup, include=FALSE}

# Set Up
library(tidyverse)
library(data.table)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)
theme_set(theme_bw() + theme(legend.position = "bottom"))
```

# Problem 1
```{r}
# Code Jeff gave us
set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))

is.list(iris_with_missing)


missing_value = function(x) {
  if (is.numeric(x)) {                    # if the value is numeric 
    y = mean(x, na.rm = TRUE)             # take the mean of the column x and save it as a value y
    x = replace(x, is.na(x), y)           # then replace any missing values in column x with the value y
  } else if (is.character(x)) {           # if the value is character variable
    x = replace(x, is.na(x), "virginica") # replace missing values in column x with virginica
  }
}

# create an output where i map my function onto each variable in my dataframe
output = map_df(iris_with_missing, missing_value)   

# checking to see if my output really works
output 

```

# Problem 2: data

```{r}

# Creating a tibble of data with file names and data

prob_data = tibble(
  subject = list.files(path = "./hw5_data",      # creating a variable "files" for filenames
                     pattern = ".csv$", 
                     full.names = TRUE)) %>%
  mutate(data =  map(subject, read_csv)) %>%    # creating a variable "data" where i read the csv files
  unnest()                                    # unnesting the variable "data"

#tidy the resulting dataset

prob_data =
pivot_longer(prob_data, 
             week_1:week_8,                            # pivoting longer to make each column a variable
             names_to = "week",
              values_to = "observations") %>%
  mutate(subject = str_extract(subject, "(con|exp)_\\d{2}"),        # extracting out group 
         group = str_extract(subject, "con|exp"),
         group = fct_recode(group, "control" = "con",               # recoding group variable
                            "experiment" = "exp")) %>%
  select(subject, group, week, observations)                        # selecting in the order I want  

knitr::kable(prob_data)  # making a nice table
```

# Problem 2: plot

```{r}

# creating a spaghetti plot for the dataframe created above

plot_ppt_data = 
  ggplot(prob_data, aes(x = week, y = observations, color = group, group = subject)) +
  geom_point() +
  geom_line() +
  viridis::scale_color_viridis(aes(color = group), discrete = TRUE) +
  labs(
    title = "Participant Observations Over Weeks By Treatment Group",
    x = "Weeks",
    y = "Observation Values"
  )

plot_ppt_data
```

The resulting plot shows the observation values for each participant over the course of 8 weeks. The control group appear to have lower observation values across weeks of the study compared to the experimental arm. The participants generally start from a similar baseline (the groups are overlapped), but as the trial moves forward, the measurements get much higher for the experimental group and stay about the same for the control group. 

# Problem 3

```{r}
sim_regression = function(n = 30, beta0 = 2, beta1) {
  sim_data = tibble(
    x = rnorm(n = 30, mean = 1, sd = 1),
    y = beta0 + beta1 * x + rnorm(n, 0, 50)
  )
  
  ls_fit = lm(y ~ x, data = sim_data)
  
  tibble(
    beta0_hat = coef(ls_fit)[1],
    beta1_hat = coef(ls_fit)[2]
  )
}



models = list("beta1_one" = 1,
              "beta1_two" = 2,
              "beta1_three" = 3,
              "beta1_four" = 4,
              "beta1_five" = 5,
              "beta1_six" = 6)

output_total = vector("list", length = 6)

for (i in 1:10000) {
  output_total[[i]] = rerun(10000, sim_regression(models[[i]])) %>%
                       bind_rows
}

broom::tidy(map(sim_regression(beta1 = models))

broom::tidy(sim_results = bind_rows(output))


sim_results = rerun(10000, sim_regression(n, 0, 50)) %>%
  bind_rows() %>%
  broom::tidy()

```

